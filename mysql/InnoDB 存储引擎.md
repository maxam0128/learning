# InnoDB 存储引擎



## 7 事务
### 7.3 分布式事务

分布式事务指允许多个独立的事务资源参与到一个全局的事务中。InnoDB中要使用分布式事务，隔离级别必须使用Serializable。

#### 7.3.1 两阶段提交

XA 事务由一个或多个资源管理器、一个事务管理器及一个应用程序组成。
 
 * 资源管理器：提供访问事务资源的方法。通常一个数据库就是一个资源管理器。
 * 事务管理器：协调参与全局事务中的各个事务，需要和参与全局事务的所有资源管理器进行通信。
 * 应用程序：定义事务的边界，指定全局事务中的操作。


分布式事务使用两阶段提交的方式。
 
 * 第一阶段：
 	* 资源管理器会询问所有的事务节点，是否可以执行提交操作
 	* 各个事务节点执行准备工作，如：为资源上锁，预留资源，undo/redo log等...
 	* 参与者响应协调者，如果事务的准备工作成功，则回应资源管理者可以提交，否则不能提交
 * 第二阶段：
	* 如果所有的参与者都回应可以提交，那么资源管理器向所有参与者发送提交命令，否则，全部回滚。

与本地事务的不同之处在于，分布式事务需要多一次的prepare操作，待收到所有节点的统一信息后，再进行commit或rollback操作。

两阶段提交带来的问题是，如果在第一节点参与全局事务的节点和资源管理器之间的通信障碍（可能是参与全局事务的一个节点没有收到信息亦或节点给资源管理器发送了消息，资源管理器没收到），。




  